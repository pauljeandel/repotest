<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>Générateur fiche produit</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="{{ url_for('static', filename='js/moment.js') }}"></script>
    <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
    <!-- * *                               SB Forms JS                               * *-->
    <!-- * * Activate your form at https://startbootstrap.com/solution/contact-forms * *-->
    <!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
    <script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
</head>

<body>

    <header class="masthead container-fluid position-relative ">
        <div class="row justify-content-center">
            <div class="col-xl-6">
                <div class="text-center text-white animate__animated animate__fadeIn animate__slow">
                    <!-- Page heading-->
                    <h1 class="mb-5">Générateur de fiche produit</h1>

                    <form class="form-inline justify-content-center" id="formulaire">
                        <div class="form-group">
                            <input class="form-control" type="text" placeholder="Description du produit" id="ville">
                        </div>
                        <button class="btn btn-primary mt-3" id="searchBarButton" type="button">Générer</button>
                        <br>
                        <span class="text-danger" id="erreur_message"></span>
                    </form>

                </div>
            </div>
        </div>
    </header>
    <div class="container">
        <div class="row d-none flex-center" id="results" style="padding:40px;">
        </div>
    </div>


    <script>
        moment.locale('fr');
        $("#searchBarButton ").click(function() {
            $("#searchBarButton").html("Chargement ..");
            $("#searchBarButton").addClass("animate__animated animate__infinite animate__rubberBand");
            $("#results").html('');
            let ville = $("#ville").val();
            for (let index = 0; index < 3; index++) {
                generate_fiche_produit(ville);
            }

        });
        $('form input').keydown(function(e) {
            if (e.keyCode == 13) {
                e.preventDefault();
                $("#searchBarButton").click();
                return false;
            }
        });

        function generate_fiche_produit(ville) {
            $.post("http://127.0.0.1:5000/api/ficheproduit", {
                    text: ville,
                    taille: 150
                },
                function(data, status) {
                    if (status == 'success') {
                        $("#searchBarButton").html("Rechercher");
                        $("#searchBarButton").removeClass("animate__animated animate__infinite animate__rubberBand");
                        $("#erreur_message").html("");
                        $("#results").removeClass("d-none");
                        $("#results").addClass("animate__animated animate__fadeIn animate__slow");
                        //scroll to the bottom
                        $('html, body').animate({
                            scrollTop: $("#results").offset().top
                        }, 1500);
                        let fiche = data;
                        console.log(fiche);
                        $("#results").append('<div id="description-card" style="width: 60vw;margin-top:30px;border-radius: 8px;box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);padding: 20px;overflow: hidden;">' + fiche + '</div>');
                    } else {
                        console.log("error : " + status);
                        $("#erreur_message").html("Une erreur est survenue. Désolé.");

                    }
                });
        }
    </script>
</body>

</html>